CREATE OR REPLACE VIEW public.vw_prc_monitor AS
select ptm.pr_number AS pr_number,ptp.ptm_number AS ptm_number,vnd.vendor_name AS vendor_name,vnd.vendor_id AS vendor_id,ptm.ptm_upreff AS ptm_upreff,ptm.ptm_downreff AS ptm_downreff,ptm.ptm_requester_name AS ptm_requester_name,ptm.ptm_requester_pos_code AS ptm_requester_pos_code,ptm.ptm_requester_pos_name AS ptm_requester_pos_name,ptm.ptm_created_date AS ptm_created_date,ptm.ptm_subject_of_work AS ptm_subject_of_work,ptm.ptm_scope_of_work AS ptm_scope_of_work,ptm.ptm_district_id AS ptm_district_id,ptm.ptm_district AS ptm_district,ptm.ptm_delivery_point_id AS ptm_delivery_point_id,ptm.ptm_delivery_point AS ptm_delivery_point,ptm.ptm_delivery_time AS ptm_delivery_time,ptm.ptm_delivery_unit AS ptm_delivery_unit,ptm.ptm_buyer AS ptm_buyer,ptm.ptm_buyer_pos_code AS ptm_buyer_pos_code,ptm.ptm_buyer_pos_name AS ptm_buyer_pos_name,ptm.ptm_currency AS ptm_currency,ptm.ptm_contract_type AS ptm_contract_type,ptm.ptm_last_participant AS ptm_last_participant,ptm.ptm_last_participant_code AS ptm_last_participant_code,ptm.ptm_is_contract_created AS ptm_is_contract_created,ptm.ptm_rfq_no AS ptm_rfq_no,ptm.ptm_status AS ptm_status,ptm.ptm_completed_date AS ptm_completed_date,ptm.ptm_tender_id AS ptm_tender_id,ptm.ptm_is_manual AS ptm_is_manual,ptm.ptm_dept_id AS ptm_dept_id,ptm.ptm_dept_name AS ptm_dept_name,ptm.ptm_mata_anggaran AS ptm_mata_anggaran,ptm.ptm_nama_mata_anggaran AS ptm_nama_mata_anggaran,ptm.ptm_sub_mata_anggaran AS ptm_sub_mata_anggaran,ptm.ptm_nama_sub_mata_anggaran AS ptm_nama_sub_mata_anggaran,ptm.ptm_pagu_anggaran AS ptm_pagu_anggaran,ptm.ptm_sisa_anggaran AS ptm_sisa_anggaran,ptm.ptm_requester_id AS ptm_requester_id,ptp.ptp_id AS ptp_id,ptp.ptp_tender_method AS ptp_tender_method,ptp.ptp_submission_method AS ptp_submission_method,ptp.ptp_evaluation_method AS ptp_evaluation_method,ptp.ptp_reg_opening_date AS ptp_reg_opening_date,ptp.ptp_reg_closing_date AS ptp_reg_closing_date,ptp.ptp_prebid_date AS ptp_prebid_date,ptp.ptp_prebid_location AS ptp_prebid_location,ptp.ptp_quot_closing_date AS ptp_quot_closing_date,ptp.ptp_tech_bid_date AS ptp_tech_bid_date,ptp.ptp_quot_opening_date AS ptp_quot_opening_date,ptp.ptp_eauction AS ptp_eauction,ptp.ptp_inquiry_notes AS ptp_inquiry_notes,ptp.ptp_enabled_rank AS ptp_enabled_rank,ptp.ptp_prequalify AS ptp_prequalify,ptp.ptp_doc_open_date AS ptp_doc_open_date,ptp.ptp_preq_info AS ptp_preq_info,ptp.evt_id AS evt_id,ptp.evt_description AS evt_description,ptp.adm_bid_committee AS adm_bid_committee,ptp.adm_bid_committee_name AS adm_bid_committee_name,ptp.ppt_id AS ppt_id,ptp.ppt_name AS ppt_name,ptp.ptp_bid_opening2 AS ptp_bid_opening2,ptp.ptp_tgl_aanwijzing2 AS ptp_tgl_aanwijzing2,ptp.ptp_lokasi_aanwijzing2 AS ptp_lokasi_aanwijzing2,ptp.ptp_klasifikasi_peserta AS ptp_klasifikasi_peserta,ptp.ptp_aanwijzing_online AS ptp_aanwijzing_online,(select scm_dev_db.public.adm_wkf_activity.awa_name from scm_dev_db.public.adm_wkf_activity where (scm_dev_db.public.adm_wkf_activity.awa_id = (select ptc.ptc_activity from scm_dev_db.public.prc_tender_comment ptc where (ptc.ptm_number = ptm.ptm_number) order by ptc.ptc_id desc limit 1))) AS status,pqvs.total AS total_contract,coalesce((select ptc.ptc_activity from scm_dev_db.public.prc_tender_comment ptc where (ptc.ptm_number = ptm.ptm_number) order by ptc.ptc_id desc limit 1),ptm.ptm_status) AS last_status,(select convert_to(ptc.ptc_position, 'UTF8') from scm_dev_db.public.prc_tender_comment ptc where (ptc.ptm_number = ptm.ptm_number) order by ptc.ptc_id desc limit 1) AS last_pos,pqm.pqm_currency AS pqm_currency from (((((scm_dev_db.public.prc_tender_main ptm left join scm_dev_db.public.prc_tender_prep ptp on((ptp.ptm_number = ptm.ptm_number))) left join scm_dev_db.public.prc_tender_vendor_status ptvs on(((ptvs.ptm_number = ptm.ptm_number) and (ptvs.pvs_is_winner = 1)))) left join scm_dev_db.public.vnd_header vnd on((vnd.vendor_id = ptvs.pvs_vendor_code))) left join scm_dev_db.public.prc_tender_quo_main pqm on(((vnd.vendor_id = pqm.ptv_vendor_code) and (ptp.ptm_number = pqm.ptm_number)))) left join scm_dev_db.public.vw_prc_quotation_vendor_sum pqvs on(((vnd.vendor_id = pqvs.ptv_vendor_code) and (pqvs.ptm_number = ptm.ptm_number))));
--haqim